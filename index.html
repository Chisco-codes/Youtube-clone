<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>YouTube Clone</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- TOP NAV -->
<header class="top-nav">
  <h1 class="logo">MyTube</h1>
  <input type="search" id="searchInput" placeholder="Search" />
  <div class="profile">ğŸ‘¤</div>
</header>

<div class="container">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <a href="index.html" data-nav="home">ğŸ  Home</a>
    <a href="trending.html" data-nav="trending">ğŸ”¥ Trending</a>
    <a href="subscriptions.html" data-nav="subscriptions">ğŸ“º Subscriptions</a>
    <a href="library.html" data-nav="library">ğŸ“ Library</a>
  </aside>

  <!-- MAIN CONTENT â€“ VIDEO GRID -->
  <main class="videos" id="videoGrid"></main>

  <!-- Load More Button -->
  <div id="loadMoreContainer" style="text-align:center; padding:40px 0; display:none;">
    <button id="loadMoreBtn" style="
      background: #065fd4;
      color: white;
      border: none;
      padding: 12px 32px;
      border-radius: 999px;
      font-size: 1rem;
      cursor: pointer;
    ">Load more</button>
  </div>
</div>

<!-- MOBILE BOTTOM NAV -->
<nav class="bottom-nav">
  <span data-nav="home">ğŸ </span>
  <span data-nav="trending">ğŸ”¥</span>
  <span data-nav="upload">â•</span>
  <span data-nav="subscriptions">ğŸ“º</span>
  <span data-nav="library">ğŸ“</span>
</nav>

<script src="data.js"></script>
<script>
  // All logic waits for DOM ready
  document.addEventListener("DOMContentLoaded", () => {
    console.log("DOM ready - initializing home page");

    const grid = document.getElementById("videoGrid");
    const searchInput = document.getElementById("searchInput");
    const loadMoreContainer = document.getElementById("loadMoreContainer");
    const loadMoreBtn = document.getElementById("loadMoreBtn");

    let loadedCount = 0;
    const batchSize = 20;
    let isLoading = false;

    // Render batch
    function renderVideoBatch(start, end) {
      if (!grid) return;

      const batch = videos.slice(start, end);

      batch.forEach(video => {
        const card = document.createElement("div");
        card.className = "video-card";

        card.innerHTML = `
          <div class="thumb-wrapper">
            <img 
              class="thumbnail" 
              src="${video.thumbnail || 'https://placehold.co/400x225/333/fff/png?text=Video'}" 
              alt="${video.title}"
              onerror="this.src='https://placehold.co/400x225/222/aaa/png?text=No+Thumb';this.onerror=null;"
            />
            <span class="duration">${video.duration || "N/A"}</span>
          </div>
          <div class="video-info">
            <div class="video-title">${video.title}</div>
            <div class="video-meta">${video.channel}</div>
            <div class="video-meta">${video.views} â€¢ ${video.time}</div>
          </div>
        `;

        card.addEventListener("click", (e) => {
          e.preventDefault();
          const url = `watch.html?id=${video.id}`;
          console.log("Video clicked â†’", url);
          window.location.href = url;
        });

        grid.appendChild(card);
      });
    }

    function updateLoadMore() {
      if (loadMoreContainer) {
        loadMoreContainer.style.display = loadedCount < videos.length ? "block" : "none";
      }
    }

    function loadNextBatch() {
      if (isLoading || loadedCount >= videos.length) return;

      isLoading = true;
      if (loadMoreBtn) {
        loadMoreBtn.textContent = "Loading...";
        loadMoreBtn.disabled = true;
      }

      const start = loadedCount;
      const end = Math.min(loadedCount + batchSize, videos.length);

      renderVideoBatch(start, end);
      loadedCount = end;

      setTimeout(() => {
        isLoading = false;
        if (loadMoreBtn) {
          loadMoreBtn.textContent = "Load more";
          loadMoreBtn.disabled = false;
        }
        updateLoadMore();
      }, 800);
    }

    // Initial load
    if (grid && typeof videos !== "undefined" && videos.length > 0) {
      grid.innerHTML = "";
      renderVideoBatch(0, batchSize);
      loadedCount = batchSize;
      updateLoadMore();
      console.log("Home initial batch loaded");
    }

    // Auto-load on scroll
    window.addEventListener("scroll", () => {
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 400) {
        loadNextBatch();
      }
    });

    // Manual Load more button
    if (loadMoreBtn) {
      loadMoreBtn.addEventListener("click", loadNextBatch);
    }

    // Search
    if (searchInput) {
      searchInput.addEventListener("input", () => {
        const val = searchInput.value.toLowerCase().trim();
        grid.innerHTML = "";
        loadedCount = 0;

        if (!val) {
          renderVideoBatch(0, batchSize);
          loadedCount = batchSize;
          updateLoadMore();
          return;
        }

        const filtered = videos.filter(v => 
          v.title.toLowerCase().includes(val) || 
          (v.channel && v.channel.toLowerCase().includes(val))
        );

        renderVideoBatch(0, filtered.length);
      });
    }

    // â”€â”€â”€ FIXED NAVIGATION â”€â”€â”€
    console.log("Attaching navigation listeners");

    // Bottom nav
    const bottomNav = document.querySelectorAll(".bottom-nav span");
    console.log("Bottom nav items:", bottomNav.length);
    bottomNav.forEach(btn => {
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        const nav = btn.dataset.nav;
        console.log("Bottom nav click:", nav);
        switch(nav) {
          case "home": window.location.href = "index.html"; break;
          case "trending": window.location.href = "trending.html"; break;
          case "upload": alert("Upload coming soon!"); break;
          case "subscriptions": window.location.href = "subscriptions.html"; break;
          case "library": window.location.href = "library.html"; break;
        }
      });
    });

    // Sidebar
    const sidebarLinks = document.querySelectorAll('.sidebar a');
    console.log("Sidebar links:", sidebarLinks.length);
    sidebarLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const nav = link.dataset.nav;
        console.log("Sidebar click:", nav);
        switch(nav) {
          case 'home': window.location.href = 'index.html'; break;
          case 'trending': window.location.href = 'trending.html'; break;
          case 'subscriptions': window.location.href = 'subscriptions.html'; break;
          case 'library': window.location.href = 'library.html'; break;
        }
      });
    });

    // Highlight active page
    const currentPage = window.location.pathname.split("/").pop() || 'index.html';
    console.log("Current page:", currentPage);

    document.querySelectorAll('.sidebar a, .bottom-nav span').forEach(el => {
      const nav = el.dataset.nav;
      if (
        (currentPage === 'index.html' && nav === 'home') ||
        (currentPage === 'trending.html' && nav === 'trending') ||
        (currentPage === 'subscriptions.html' && nav === 'subscriptions') ||
        (currentPage === 'library.html' && nav === 'library')
      ) {
        el.classList.add('active');
      } else {
        el.classList.remove('active');
      }
    });
  });
</script>

</body>
</html>