<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trending - MyTube Clone</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header class="top-nav">
  <h1 class="logo">MyTube</h1>
  <input type="search" id="searchInput" placeholder="Search" />
  <div class="profile">ğŸ‘¤</div>
</header>

<div class="container">
  <aside class="sidebar">
    <a href="index.html" data-nav="home">ğŸ  Home</a>
    <a href="trending.html" data-nav="trending">ğŸ”¥ Trending</a>
    <a href="subscriptions.html" data-nav="subscriptions">ğŸ“º Subscriptions</a>
    <a href="library.html" data-nav="library">ğŸ“ Library</a>
  </aside>

  <main class="trending-main">

    <!-- Trending Tabs -->
    <div class="trending-tabs">
      <button data-tab="music" class="active">ğŸµ Music</button>
      <button data-tab="balanced">ğŸ”¥ Balanced</button>
      <button data-tab="gaming">ğŸ® Gaming</button>
    </div>

    <!-- Featured #1 Video -->
    <div id="featuredVideo" class="featured-video"></div>

    <!-- Trending Videos Grid -->
    <div id="trendingGrid" class="videos-grid"></div>

    <!-- Load More Button for Trending -->
    <div id="loadMoreTrending" style="text-align:center; padding:40px 0; display:none;">
      <button id="loadMoreTrendingBtn" style="
        background: #065fd4;
        color: white;
        border: none;
        padding: 12px 32px;
        border-radius: 999px;
        font-size: 1rem;
        cursor: pointer;
      ">
        Load more
      </button>
    </div>

  </main>
</div>

<nav class="bottom-nav">
  <span data-nav="home">ğŸ </span>
  <span data-nav="trending">ğŸ”¥</span>
  <span data-nav="upload">â•</span>
  <span data-nav="subscriptions">ğŸ“º</span>
  <span data-nav="library">ğŸ“</span>
</nav>

<script src="data.js"></script>
<script src="trending.js"></script>
<script>
  // â”€â”€â”€ Infinite Scroll + Load More for Trending â”€â”€â”€
  document.addEventListener("DOMContentLoaded", () => {
    const trendingGrid = document.getElementById("trendingGrid");
    const loadMoreContainer = document.getElementById("loadMoreTrending");
    const loadMoreBtn = document.getElementById("loadMoreTrendingBtn");

    let currentMode = "music"; // default tab
    let loadedCount = 0;
    const batchSize = 15;
    let isLoading = false;
    let currentList = []; // current sorted list for the active tab

    // Update grid with current batch
    function appendTrendingBatch(start, end) {
      if (!trendingGrid) return;

      const batch = currentList.slice(start, end);

      batch.forEach((video, index) => {
        const globalIndex = start + index;
        const card = document.createElement("div");
        card.className = "video-card";
        card.innerHTML = `
          <div class="thumb-wrapper">
            <img class="thumbnail" src="${video.thumbnail}" alt="${video.title}">
            <span class="duration">${video.duration || "N/A"}</span>
            <span class="trending-rank">ğŸ”¥ #${globalIndex + 1}</span>
          </div>
          <div class="video-info">
            <div class="video-title">${video.title}</div>
            <div class="video-meta">
              ${video.channel}<br>
              ${video.views} â€¢ ${video.time}
            </div>
          </div>
        `;
        card.addEventListener("click", () => {
          window.location.href = `watch.html?id=${video.id}`;
        });
        trendingGrid.appendChild(card);
      });

      console.log(`Trending: Appended batch ${start} â†’ ${end-1} (${batch.length} cards)`);
    }

    // Load next batch (called by scroll or button)
    function loadNextTrendingBatch() {
      if (isLoading || loadedCount >= currentList.length) return;

      isLoading = true;
      if (loadMoreBtn) {
        loadMoreBtn.textContent = "Loading...";
        loadMoreBtn.disabled = true;
      }

      const nextStart = loadedCount;
      const nextEnd = Math.min(loadedCount + batchSize, currentList.length);

      appendTrendingBatch(nextStart, nextEnd);
      loadedCount = nextEnd;

      setTimeout(() => {
        isLoading = false;
        if (loadMoreBtn) {
          loadMoreBtn.textContent = "Load more";
          loadMoreBtn.disabled = false;
        }
        updateLoadMoreVisibility();
      }, 800);
    }

    // Show/hide Load more button
    function updateLoadMoreVisibility() {
      if (loadedCount < currentList.length && loadMoreContainer) {
        loadMoreContainer.style.display = "block";
      } else if (loadMoreContainer) {
        loadMoreContainer.style.display = "none";
      }
    }

    // Re-render trending when tab changes (reset loaded count)
    function refreshTrendingGrid(mode) {
      if (!trendingGrid) return;

      // Clear old content (except featured if you want to keep it)
      trendingGrid.innerHTML = "";
      loadedCount = 0;

      // Get new sorted list for this mode
      currentList = getTrendingVideos(mode); // your existing function
      currentMode = mode;

      // Render first batch
      appendTrendingBatch(0, batchSize);
      loadedCount = batchSize;

      updateLoadMoreVisibility();
      console.log(`Trending refreshed for ${mode} - ${currentList.length} videos available`);
    }

    // Hook into your existing tab switching (add this after your tabs.forEach)
    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        tabs.forEach(t => t.classList.remove("active"));
        tab.classList.add("active");

        const mode = tab.dataset.tab;
        refreshTrendingGrid(mode);
      });
    });

    // Initial load (music tab)
    refreshTrendingGrid("music");

    // Infinite scroll
    window.addEventListener("scroll", () => {
      if (isLoading || loadedCount >= currentList.length) return;

      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 300) {
        loadNextTrendingBatch();
      }
    });

    // Load more button click
    if (loadMoreBtn) {
      loadMoreBtn.addEventListener("click", loadNextTrendingBatch);
    }

    console.log("Trending infinite scroll + load more ready");
  });
</script>

</body>
</html>