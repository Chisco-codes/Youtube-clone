<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trending - MyTube Clone</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header class="top-nav">
  <h1 class="logo">MyTube</h1>
  <input type="search" id="searchInput" placeholder="Search" />
  <div class="profile">ğŸ‘¤</div>
</header>

<div class="container">
  <aside class="sidebar">
    <a href="index.html" data-nav="home">ğŸ  Home</a>
    <a href="trending.html" data-nav="trending">ğŸ”¥ Trending</a>
    <a href="subscriptions.html" data-nav="subscriptions">ğŸ“º Subscriptions</a>
    <a href="library.html" data-nav="library">ğŸ“ Library</a>
  </aside>

  <main class="trending-main">

    <!-- Trending Tabs -->
    <div class="trending-tabs">
      <button data-tab="music" class="active">ğŸµ Music</button>
      <button data-tab="balanced">ğŸ”¥ Balanced</button>
      <button data-tab="gaming">ğŸ® Gaming</button>
    </div>

    <!-- Featured #1 Video -->
    <div id="featuredVideo" class="featured-video"></div>

    <!-- Trending Videos Grid -->
    <div id="trendingGrid" class="videos-grid"></div>

    <!-- Load More Button -->
    <div id="loadMoreTrending" style="text-align:center; padding:40px 0; display:none;">
      <button id="loadMoreTrendingBtn" style="
        background: #065fd4;
        color: white;
        border: none;
        padding: 12px 32px;
        border-radius: 999px;
        font-size: 1rem;
        cursor: pointer;
        min-width: 140px;
      ">
        Load more
      </button>
    </div>

  </main>
</div>

<nav class="bottom-nav">
  <span data-nav="home">ğŸ </span>
  <span data-nav="trending">ğŸ”¥</span>
  <span data-nav="upload">â•</span>
  <span data-nav="subscriptions">ğŸ“º</span>
  <span data-nav="library">ğŸ“</span>
</nav>

<script src="data.js"></script>
<script src="trending.js"></script>
<script>
  // Infinite Scroll + Load More for Trending (your existing code, unchanged)
  document.addEventListener("DOMContentLoaded", () => {
    const grid = document.getElementById("trendingGrid");
    const loadMoreContainer = document.getElementById("loadMoreTrending");
    const loadMoreBtn = document.getElementById("loadMoreTrendingBtn");

    let currentMode = "music";
    let loadedCount = 0;
    const batchSize = 15;
    let isLoading = false;
    let currentList = [];

    function appendBatch(start, end) {
      if (!grid) return;

      const batch = currentList.slice(start, end);

      batch.forEach((video, index) => {
        const globalIndex = start + index;
        const card = document.createElement("div");
        card.className = "video-card";

        card.innerHTML = `
          <div class="thumb-wrapper">
            <img class="thumbnail" src="${video.thumbnail || 'https://placehold.co/400x225/333/fff/png?text=Video'}" alt="${video.title}">
            <span class="duration">${video.duration || "N/A"}</span>
            <span class="trending-rank">ğŸ”¥ #${globalIndex + 1}</span>
          </div>
          <div class="video-info">
            <div class="video-title">${video.title}</div>
            <div class="video-meta">
              ${video.channel}<br>
              ${video.views} â€¢ ${video.time}
            </div>
          </div>
        `;

        card.addEventListener("click", () => {
          window.location.href = `watch.html?id=${video.id}`;
        });

        grid.appendChild(card);
      });
    }

    function loadNextBatch() {
      if (isLoading || loadedCount >= currentList.length) return;

      isLoading = true;
      if (loadMoreBtn) {
        loadMoreBtn.textContent = "Loading...";
        loadMoreBtn.disabled = true;
      }

      const nextStart = loadedCount;
      const nextEnd = Math.min(loadedCount + batchSize, currentList.length);

      appendBatch(nextStart, nextEnd);
      loadedCount = nextEnd;

      setTimeout(() => {
        isLoading = false;
        if (loadMoreBtn) {
          loadMoreBtn.textContent = "Load more";
          loadMoreBtn.disabled = false;
        }
        updateLoadMoreBtn();
      }, 800);
    }

    function updateLoadMoreBtn() {
      if (loadMoreContainer) {
        loadMoreContainer.style.display = loadedCount < currentList.length ? "block" : "none";
      }
    }

    function refreshTrending(mode) {
      if (!grid) return;

      grid.innerHTML = "";
      loadedCount = 0;

      currentList = getTrendingVideos(mode); // from trending.js
      currentMode = mode;

      appendBatch(0, batchSize);
      loadedCount = batchSize;
      updateLoadMoreBtn();
    }

    // Hook into tab clicks
    const tabs = document.querySelectorAll(".trending-tabs button");
    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        tabs.forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        refreshTrending(tab.dataset.tab);
      });
    });

    // Initial load
    refreshTrending("music");

    // Infinite scroll
    window.addEventListener("scroll", () => {
      if (isLoading || loadedCount >= currentList.length) return;

      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 300) {
        loadNextBatch();
      }
    });

    // Load more button
    if (loadMoreBtn) {
      loadMoreBtn.addEventListener("click", loadNextBatch);
    }

    // â”€â”€â”€ FIXED NAVIGATION (sidebar + bottom nav) â”€â”€â”€
    console.log("Attaching navigation listeners (trending page)");

    // Bottom nav
    const bottomNav = document.querySelectorAll(".bottom-nav span");
    console.log("Bottom nav items found:", bottomNav.length);
    bottomNav.forEach(btn => {
      btn.addEventListener("click", (e) => {
        e.preventDefault();
        const nav = btn.dataset.nav;
        console.log("Bottom nav clicked:", nav);
        switch(nav) {
          case "home": window.location.href = "index.html"; break;
          case "trending": window.location.href = "trending.html"; break;
          case "upload": alert("Upload coming soon!"); break;
          case "subscriptions": window.location.href = "subscriptions.html"; break;
          case "library": window.location.href = "library.html"; break;
        }
      });
    });

    // Sidebar
    const sidebarLinks = document.querySelectorAll('.sidebar a');
    console.log("Sidebar links found:", sidebarLinks.length);
    sidebarLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const nav = link.dataset.nav;
        console.log("Sidebar clicked:", nav);
        switch(nav) {
          case 'home': window.location.href = 'index.html'; break;
          case 'trending': window.location.href = 'trending.html'; break;
          case 'subscriptions': window.location.href = 'subscriptions.html'; break;
          case 'library': window.location.href = 'library.html'; break;
        }
      });
    });

    // Highlight active page
    const currentPage = window.location.pathname.split("/").pop() || 'trending.html';
    console.log("Current page:", currentPage);

    document.querySelectorAll('.sidebar a, .bottom-nav span').forEach(el => {
      const nav = el.dataset.nav;
      if (
        (currentPage === 'index.html' && nav === 'home') ||
        (currentPage === 'trending.html' && nav === 'trending') ||
        (currentPage === 'subscriptions.html' && nav === 'subscriptions') ||
        (currentPage === 'library.html' && nav === 'library')
      ) {
        el.classList.add('active');
      } else {
        el.classList.remove('active');
      }
    });
  });
</script>

</body>
</html>